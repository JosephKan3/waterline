# Waterline Tier Controller

AE2-based tiered machine activation for OpenComputers. Monitors item/fluid levels in your AE2 network and triggers redstone outputs when requirements are met.

## Features

- **9 Toggleable Controls** - Tier 0 (main) + Tiers 1-8 (individual machines)
- **AE2 Integration** - Reads items and fluids directly from your ME network
- **Tiered Activation** - Each tier has configurable material requirements
- **Redstone Output** - Emits signal strength 15 when tier requirements are met
- **Auto-Update** - Downloads latest files from GitHub

## Requirements

### Hardware
- **ME Interface** (full block) connected to an **Adapter**
- **Redstone I/O** blocks for each tier you want to control
- **Internet Card** (for setup/updates)
- Standard OpenComputers components (Computer Case, CPU, RAM, etc.)

## Installation

1. Download json library (required):
```bash
wget https://raw.githubusercontent.com/rxi/json.lua/master/json.lua /lib/json.lua
```

2. Download and run setup:
```bash
wget -f https://raw.githubusercontent.com/JosephKan3/waterline/main/setup.lua
setup
```

## Usage

### Starting the Controller
```bash
controller
```

**Press Q** to exit and safely disable all redstone outputs.

### Reconfigure Hardware
```bash
setup
```

## Configuration

### Redstone Configuration (`redstone_config.lua`)

Generated by `setup.lua`. Maps each tier to a redstone I/O address and output side:

```lua
config.tiers = {
    [0] = { address = "abc123...", side = 3 }, -- Main controller
    [1] = { address = "def456...", side = 2 }, -- Tier 1
    -- ...
}
```

**Sides:** bottom=0, top=1, north=2, south=3, west=4, east=5

### Tier Requirements (`tiers_config.lua`)

Define what items/fluids are required for each tier to activate:

```lua
local tiers = {}

tiers[1] = {
    { name = "Water", amount = 10000, type = "fluid" },
}

tiers[2] = {
    { name = "Filtered Water (Grade 1)", amount = 5000, type = "fluid" },
    { name = "Ozone", amount = 1000, type = "fluid" },
}

-- Add more tiers...

return tiers
```

- `name` - Exact label as shown in AE2
- `amount` - Required quantity (mB for fluids, count for items)
- `type` - Either `"fluid"` or `"item"`

## How It Works

1. Every 120 seconds (configurable), the controller checks AE2 for each tier's requirements
2. If ALL requirements for a tier are met, that tier's redstone output goes HIGH (15)
3. **Control 0** activates when ANY tier (1-8) is active
4. If requirements are not met, redstone output goes LOW (0)

## File Structure

```
waterline/
├── setup.lua           # Installer and hardware configuration
├── controller.lua      # Main controller script
├── tiers_config.lua    # Tier material requirements
├── redstone_config.lua # Generated hardware config
└── src/
    └── AE2.lua         # AE2 helper module
```

## Troubleshooting

### "No ME Interface found"
- Ensure ME Interface (full block) is connected via Adapter
- Check that the Adapter is adjacent to the computer

### Tier not activating
- Verify item/fluid names match exactly (case-sensitive)
- Check that amounts are in correct units (mB for fluids)
- Run `controller` and check the status display for details

### Redstone not working
- Verify redstone I/O address in `redstone_config.lua`
- Check the output side is correct
- Ensure redstone I/O is connected to target machine

## License

Open source. Free to use and modify.

## Support

Issues and contributions: https://github.com/JosephKan3/waterline
